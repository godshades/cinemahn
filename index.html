<!DOCTYPE html>
<html>

<head>
	<meta charset='utf-8' />
	<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
	<link href='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.7.0/fullcalendar.min.css' rel='stylesheet' />
	<link href='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.7.0/fullcalendar.print.css' rel='stylesheet' media='print' />
	<script src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.19.3/moment.min.js'></script>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js'></script>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.7.0/fullcalendar.min.js'></script>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/datejs/1.0/date.min.js'></script>
	<script>
		$(document).ready(function() {
			//Calendar
			var date = new Date();
			var d = date.getDate();
			var m = date.getMonth();
			var y = date.getFullYear();

			$('#calendar').fullCalendar({
				header: {
					left: 'prev,next today',
					center: 'title',
					right: 'month,agendaWeek,agendaDay'
				},
				displayEventTime: false,
				editable: true,
				events: [{
						title: 'CGV tăng 3',
						start: '22:00',
						dow: [1, 2, 3, 4, 5],
						description: '50K sau 22h',
						url: 'https://rapchieuphim.com/khuyen-mai/xem-phim-tang-3-gia-chi-50k-tai-cgv'
					},
					{
						title: 'Beta - Thứ Ba vui vẻ',
						start: '08:30',
						dow: [2],
						description: '45k (2D) và 65k (3D)',
						url: 'https://moveek.com/khuyen-mai/beta-cineplex-thu-ba-vui-ve/'
					},
					{
						title: 'Lotte LOVELY TUESDAY',
						start: '08:30',
						dow: [2],
						description: '45-60k (2D) và 75-90k (3D)',
						url: 'https://lottecinemavn.com/vi-vn/su-kien/lovely-tuesday-(tu-15-09).aspx'
					},
					{
						title: 'Platinum Special Couple\'s Day',
						start: '10:00',
						dow: [2],
						description: 'mua 2 vé tặng 1 bỏng và 2 đồ uống,',
						url: 'https://platinumcineplex.vn/vi/news/news-and-promotion/special-couple-s-day'
					},
					{
						title: 'Platinum Special Thursday',
						start: '10:00',
						dow: [4],
						description: '45K 2D',
						url: 'https://platinumcineplex.vn/vi/news/news-and-promotion/n-a'
					},
					{
						title: 'Platinum ladies\' night',
						start: '10:00',
						dow: [3],
						description: 'giảm 50% cho vé thứ 2 và 1 phiếu giảm 50% cho 1 loại combo tại quầy Concessions cho nữ',
						url: 'https://platinumcineplex.vn/vi/news/news-and-promotion/ladies-night'
					},
				],
				eventClick: function(event) {
					if (event.url) {
						window.open(event.url);
						return false;
					}
				},
				eventRender: function(event, element) {
					element.find('.fc-title').append("<br/>" + event.description);
				}
			});
			// adding a custom events:
			$('#calendar').fullCalendar('addEventSource',
				function(start, end, timezone, callback) {

					var events = [];

					var y = start._d.getFullYear(),
						m = start._d.getMonth();
					var firstDay = new Date(y, m, 1);
					var lastDay = new Date(y, m + 1, 0);

					var test_date = new Date(lastDay);
					while (test_date.getDay() !== 1) {
						test_date.setDate(test_date.getDate() - 1);
					}

					// Last monday of last month
					if (test_date.is().monday()) {
						events.push({
								title: 'CGV CULTURE DAY',
								start: '08:30',
								start: test_date,
								description: '50K 2D',
								url: 'https://www.cgv.vn/default/newsoffer/cgv-culture-day/'
							}, // CGV
							{
								title: 'Lotte Big Smile Day',
								start: '08:30',
								start: test_date,
								description: '45K 2D',
								url: 'https://lottecinemavn.com/vi-vn/su-kien/e-l-selection/big-smile-day-45,000-50,000-%C4%91ong-ve-xem-phim-t.aspx'
							} // lottecinema
						);
					}

					y = end._d.getFullYear(),
						m = end._d.getMonth() - 1;
					firstDay = new Date(y, m, 1);
					lastDay = new Date(y, m + 1, 0);

					test_date = new Date(lastDay);

					while (test_date.getDay() !== 1) {
						test_date.setDate(test_date.getDate() - 1);
					}

					// Last monday of current month
					if (test_date.is().monday()) {
						events.push({
								title: 'CGV CULTURE DAY',
								start: '08:30',
								start: test_date,
								description: '50K 2D',
								url: 'https://www.cgv.vn/default/newsoffer/cgv-culture-day/'
							}, // CGV
							{
								title: 'Lotte Big Smile Day',
								start: '08:30',
								start: test_date,
								description: '45K 2D',
								url: 'https://lottecinemavn.com/vi-vn/su-kien/e-l-selection/big-smile-day-45,000-50,000-%C4%91ong-ve-xem-phim-t.aspx'
							} // lottecinema
						);
					}


					// First wednesday current month
					y = start._d.getFullYear(),
						m = start._d.getMonth();
					firstDay = new Date(y, m, 1);
					lastDay = new Date(y, m + 1, 0);

					test_date = new Date(lastDay);
					while (test_date.getDay() !== 3) {
						test_date.setDate(test_date.getDate() + 1);
					}

					if (test_date.is().wednesday()) {
						events.push({
							title: 'BHD B\'DAY',
							start: '08:30',
							start: test_date,
							description: '45K 2D',
							url: 'http://www.bhdstar.vn/deals/bday-2/'
						});
					}

					// First wednesday next month
					y = end._d.getFullYear(),
						m = end._d.getMonth();
					firstDay = new Date(y, m, 1);
					lastDay = new Date(y, m + 1, 0);

					test_date = new Date(firstDay);
					while (test_date.getDay() !== 3) {
						test_date.setDate(test_date.getDate() + 1);
					}

					if (test_date.is().wednesday()) {
						events.push({
							title: 'BHD B\'DAY',
							start: '08:30',
							start: test_date,
							description: '45K 2D',
							url: 'http://www.bhdstar.vn/deals/bday-2/'
						});
					}

					// First monday current month
					y = start._d.getFullYear(),
						m = start._d.getMonth();
					firstDay = new Date(y, m, 1);
					lastDay = new Date(y, m + 1, 0);

					test_date = new Date(lastDay);
					while (test_date.getDay() !== 1) {
						test_date.setDate(test_date.getDate() + 1);
					}

					if (test_date.is().monday()) {
						events.push({
							title: 'Beta - MAD SALE DAY',
							start: '08:30',
							start: test_date,
							description: '45K 2D & tặng 1 bỏng (Phụ thu 5k đối với phim bom tấn)',
							url: 'https://betacineplex.vn/tin-moi/bung-no-voi-mad-sale-day/118'
						});

					}

					// First monday next month
					y = end._d.getFullYear(),
						m = end._d.getMonth();
					firstDay = new Date(y, m, 1);
					lastDay = new Date(y, m + 1, 0);

					test_date = new Date(firstDay);
					while (test_date.getDay() !== 1) {
						test_date.setDate(test_date.getDate() + 1);
					}

					if (test_date.is().monday()) {
						events.push({
							title: 'Beta - MAD SALE DAY',
							start: '08:30',
							start: test_date,
							description: '45K 2D & tặng 1 bỏng (Phụ thu 5k đối với phim bom tấn)',
							url: 'https://betacineplex.vn/tin-moi/bung-no-voi-mad-sale-day/118'
						});

					}

					// return events generated
					callback(events);
				}
			);
		});
	</script>
	<style>
		html {
			width: 100%;
			height: 100%;
		}

		body {
			--margin: 40px 10px;
			padding: 0;
			font-family: 'Roboto', sans-serif;
			font-size: 14px;
			height: 100%;
		}

		#calendar {
			--margin: 0 auto;
			margin-top: 1%;
		}

		.fc-title {
			white-space: normal;
		}

		#cinema {
			overflow: hidden;
			width: 100%;
			height: 30%;
		}

		#googleMap {
			float: left;
			width: 70%;
			height: 100%;
		}

		#lstcinema {
			width: 30%;
			height: 100%;
			overflow: auto;
		}

		.inline {
			display: inline-block;
		}

		a {
			text-decoration: none;
		}

		#lstcinema a:visited {
			color: blue;
		}

		#currentWeather {
			overflow: hidden;
			float: left;
			width: 40%;
		}

		#timelineWeather {
			overflow: hidden;
			width: 60%;
		}

		#ifram1 {
			border: 0px none;
			height: 212px;
			margin-top: -132px;
			width: -webkit-fill-available;
		}

		#ifram2 {
			border: 0px none;
			height: 393px;
			margin-top: -295px;
			width: -webkit-fill-available;
		}
	</style>
</head>

<body>
	<div id="currentWeather">
		<iframe id="ifram1" scrolling="no" src="about:blank">
		</iframe>
	</div>
	<div id="timelineWeather">
		<iframe id="ifram2" scrolling="no" src="about:blank">
		</iframe>
	</div>
	<div id="cinema">
		<div id="googleMap" class="inline"></div>
		<div id="lstcinema" class="inline">
			<ol id="list"></ol>
		</div>
	</div>
	<div id='calendar'></div>
</body>
<script>
	//Google map
	function initMap() {

		var myLatLng;
		var infowindow = new google.maps.InfoWindow();
		var golInfo = new google.maps.InfoWindow();
		var marker, i, cinema;
		var distance;
		var list, entry, li;
		var distanceArr = [];
		var cinemaArr = [];
		var infoWindowArr = [];
		var link;

		if (navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(function(position) {
				//myLatLng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude)
				myLatLng = new google.maps.LatLng(21.0468179, 105.7951931)

				var mapProp = {
					center: myLatLng,
					zoom: 13,
				};
				var map = new google.maps.Map(document.getElementById("googleMap"), mapProp);

				var currentMarker = new google.maps.Marker({
					position: myLatLng,
					map: map
				});

				google.maps.event.addListener(currentMarker, 'click', (function(currentMarker, i) {
					return function() {
						infowindow.setContent('You are here');
						infowindow.open(map, currentMarker);
					}
				})(currentMarker, i));

				//link = 'https://darksky.net/forecast/'+ position.coords.latitude + ',' + position.coords.longitude +'/si12/en';
				link = 'https://darksky.net/forecast/21.0468,105.7952/si12/en';
				document.getElementById('ifram1').src = link;
				document.getElementById('ifram2').src = link;

				var locations = [
					//HÀ NỘI
					['CGV Vincom Center Bà Triệu', 21.0110831, 105.8495107],
					['CGV Vincom Nguyễn Chí Thanh', 21.0232842, 105.8070238],
					['CGV Aeon Long Biên', 21.0265591, 105.8984919],
					['CGV Hà Nội Centerpoint', 21.0048854, 105.8025138],
					['CGV Mipec Tower', 21.0059122, 105.8211195],
					['CGV Vincom Mega Mall Royal City', 21.0030263, 105.8132952],
					['CGV Vincom Long Biên', 21.0509866, 105.9141536],
					['CGV Artemis Hà Nội', 20.9996882, 105.8261619],
					['CGV Vincom Mega Mall Times City', 20.9942669, 105.8684911],
					['CGV Rice City', 20.9634609, 105.8208142],
					['CGV Hồ Gươm Plaza', 20.9790077, 105.7834491],

					['Lotte Cinema Keangnam', 21.0170462, 105.7835932],
					['Lotte Cinema Hà Đông', 20.9636625, 105.7696228],
					['Lotte Cinema Thăng Long', 21.0079594, 105.7910885],

					['Beta Cineplex Thanh Xuân', 21.0026136, 105.8001022],
					['Beta Cineplex Mỹ Đình', 21.0119067, 105.7730692],

					['Platinum Cinema Garden', 21.01535, 105.7757443],
					['BHD Star Vincom', 21.0064286, 105.8298065],
					['Rạp Quốc gia', 21.0167483, 105.813379],
					['Galaxy Cinema Long Biên', 21.0454663, 105.8635872],
					['Fafim Cinema', 21.0019643, 105.8181819],
					['Rạp Tháng 8', 21.0214854, 105.8503522],
					['Rạp Kim Đồng', 21.0238755, 105.8507703],

					//HCM
					['Cinestar Hai Bà Trưng', 10.782454, 106.695984],
					['Cinestar Cinema Quốc Thanh', 10.763907, 106.6851049],
					['Lotte Cinema Gò Vấp', 10.8382285, 106.6690033],
					['Lotte Cinema Phú Thọ', 10.7631133, 106.6548846],
					['Lotte Cinema Thủ Đức', 10.8712548, 106.7670491],
					['Lotte Cinema Cộng Hoà', 10.8007354, 106.6508857],
					['Lotte Cinema Nam Sài Gòn', 10.7409423, 106.700126],
					['Lotte Cinema Nowzone', 10.7638952, 106.6805318],
					['Lotte Cinema Diamond', 10.7809704, 106.6980006],
					['Lotte Cinema Cantavil', 10.8017125, 106.7449772],
					['BHD Star Cineplex - Bitexco', 10.7716687, 106.7043854],
					['BHD Star Cineplex - Vincom Thảo Điền', 10.8023027, 106.7387646],
					['BHD Star Cineplex - 3/2', 10.7758833, 106.6804691],
					['BHD Star Cineplex - Phạm Hùng', 10.7335534, 106.6722166],
					['BHD Star Cineplex - Vincom Quang Trung', 10.8293161, 106.6703183],
					['BHD Star Cineplex - Vincom Lê Văn Việt', 10.8455374, 106.7791753],
					['Galaxy Cinema Nguyễn Du', 10.772937, 106.6911983],
					['Galaxy Cinema Trung Chánh', 10.8553679, 106.6058189],
					['Galaxy Cinema Quang Trung', 10.8347421, 106.6600354],
					['Galaxy Cinema Phạm Văn Chí', 10.7409146, 106.6361711],
					['Galaxy Cinema Tân Bình', 10.7902587, 106.6385232],
					['Galaxy Cinema Kinh Dương Vương', 10.7500903, 106.6259716],
					['Galaxy Cinema Huỳnh Tấn Phát', 10.7124455, 106.7347359],
					['Đống Đa Cinema', 10.753524, 106.6720583],
					['MegaGS Cinema - Cao Thắng', 10.769061, 106.6809273],
					['CGV - Golden Plaza', 10.7536086, 106.6525759],
					['CGV - Vincom Đồng Khởi', 10.7779234, 106.6997641],
					['CGV - Parkson Đồng Khởi', 10.7772273, 106.7000056],
					['CGV - CGV Saigonres Nguyễn Xí', 10.8164305, 106.7050385],
					['CGV - Liberty Citypoint', 10.7746086, 106.698639],
					['CGV - CT Plaza', 10.813248, 106.6636266],
					['CGV - Aeon Bình Tân', 10.7432125, 106.6109858],
					['CGV - Thảo Điền Pearl', 10.8017757, 106.730614],
					['CGV - Parkson Paragon', 10.729619, 106.7194853],
					['CGV - Hoàng Văn Thụ', 10.7989085, 106.6577052],
					['CGV - Pearl Plaza', 10.8001177, 106.7162992],
					['CGV - Thủ Đức', 10.850432, 106.7631052],
					['CGV - Celadon Tân Phú', 10.801702, 106.6179746],
					['CGV - Hùng Vương Plaza', 10.7557866, 106.6608583],
					['CGV - Gò Vấp', 10.8267795, 106.6869587],
					['CGV - Pandora City', 10.8069193, 106.6320505],
					['CGV - VivoCity', 10.7301828, 106.7016488],
					['CGV - Crescent Mall', 10.72907, 106.7167563],
					['Cinebox - Lý Chính Thắng', 10.7804476, 106.6804078],

					//Đà Nẵng
					['Lotte Cinema - Đà Nẵng', 16.0351775, 108.2290006],
					['Galaxy Cinema - Đà Nẵng', 16.0666313, 108.1844025],
					['Starlight - Đà Nẵng', 16.0662446, 108.2011324],
					['CGV - Vĩnh Trung Plaza', 16.0666435, 108.2109096],
					['CGV - Vincom Đà Nẵng', 16.0710745, 108.2279928],

					//Hải Phòng
					['Lotte Cinema Hải Phòng', 20.8658747, 106.6891766],
					['Galaxy Cinema Hải Phòng', 20.8562254, 106.6842553],
					['CGV - Thùy Dương Plaza', 20.8463948, 106.7046992],

					//Biên Hoà
					['Lotte Cinema - Biên Hòa', 10.9577074, 106.8431749],
					['Lotte Cinema - Đồng Nai', 10.9486682, 106.8711227],
					['Beta Cineplex Biên Hòa', 10.9470274, 106.8226943],
					['CGV - Coop Mart Biên Hoà', 10.9584608, 106.8317999],
					['CGV - Big C Đồng Nai', 10.9066022, 106.8487698],

					//Nha Trang
					['Lotte Cinema Nha Trang', 12.2483989, 109.1845781],
					['Platinum Cineplex – Nha Trang', 12.2478777, 109.1935833],

					//Bình Dương
					['Lotte Cinema - Bình Dương', 10.9050217, 106.711583],
					['CGV - Bình Dương Square', 10.9842298, 106.6649294],
					['CGV - Aeon Canary', 10.9309662, 106.7097347],
					['Empire Cineplex Bình Dương', 10.9746822, 106.656628],

					//Phan Thiết
					['Lotte Cinema - Phan Thiết', 10.9387914, 108.1109073],

					//Hạ Long
					['Lotte Cinema Hạ Long', 20.9421623, 107.108363],
					['CGV - Marine Plaza', 20.955323, 107.0106017],
					['CGV - Vincom Hạ Long', 20.9502607, 107.0819622],

					//Cần Thơ
					['Lotte Cinema Ninh Kiều', 10.0422661, 105.7647532],
					['Lotte Cinema - Cái Răng', 10.0142849, 105.782547],
					['CGV - Vincom Xuân Khánh', 10.0246788, 105.7727147],
					['CGV - Sense City', 10.0341076, 105.7837808],
					['CGV - Vincom Hùng Vương', 10.0453833, 105.777425],

					//Vũng Tàu
					['Lotte Cinema Vũng Tàu', 10.3498331, 107.0914092],
					['CGV - Lam Sơn Square', 10.3485847, 107.0718382],
				];

				for (i = 0; i < locations.length; i++) {
					cinema = new google.maps.LatLng(locations[i][1], locations[i][2]);

					marker = new google.maps.Marker({
						position: cinema,
						map: map
					});

					google.maps.event.addListener(marker, 'click', (function(marker, i) {
						return function() {
							infowindow.setContent(locations[i][0]);
							infowindow.open(map, marker);
						}
					})(marker, i));

					distance = google.maps.geometry.spherical.computeDistanceBetween(myLatLng, cinema)
					//distance = distance / 1000 + 'km'
					distanceArr.push([Math.round(distance) / 1000, locations[i][0], locations[i][1], locations[i][2]])

					cinemaArr.push(cinema);
				}
				distanceArr.sort(function(a, b) {
					return a[0] - b[0]
				});
				var li;

				for (i = 0; i < distanceArr.length; i++) {
					list = document.getElementById('list');
					li = document.createElement("li");
					entry = document.createElement('a');
					entry.setAttribute("href", "#");
					entry.setAttribute("id", "cinema" + i);
					entry.setAttribute("lat", distanceArr[i][2]);
					entry.setAttribute("lng", distanceArr[i][3]);
					entry.appendChild(document.createTextNode('Your location to ' + distanceArr[i][1] + ' : ' + distanceArr[i][0] + ' km'));
					li.appendChild(entry);
					list.appendChild(li);
				}
				// Instantiate a directions service.
				var directionsService = new google.maps.DirectionsService
				var directionDisplay;
				var directionsDisplay = [];

				$('a').click(function(e) {
					cinema = new google.maps.LatLng($(this).attr('lat'), $(this).attr('lng'));
					for (var i = 0; i < infoWindowArr.length; i++) {
						infoWindowArr[i].close()
					}
					//calculateAndDisplayRoute(map, directionsDisplay, directionsService, directionDisplay, myLatLng, cinema);
					directionsService.route({
						origin: myLatLng,
						destination: cinema,
						provideRouteAlternatives: true,
						travelMode: google.maps.TravelMode.DRIVING,
						optimizeWaypoints: true
					}, function(response, status) {
						if (status == google.maps.DirectionsStatus.OK) {
							for (i = 0; i < directionsDisplay.length; i++) {
								directionsDisplay[i].setMap(null);
							}

							for (i = 0; i < response.routes.length; i++) {
								directionDisplay = new google.maps.DirectionsRenderer({
									map: map,
									directions: response,
									routeIndex: i
								})
								directionsDisplay.push(directionDisplay);
								var infoLeg = new google.maps.InfoWindow();
								infoLeg = new google.maps.InfoWindow();
								var step = Math.floor((response.routes[i].legs[0].steps.length / 2) + 1);
								infoLeg.setContent(response.routes[i].legs[0].distance.text + "<br>" + response.routes[i].legs[0].duration.text + " ");
								infoLeg.setPosition(response.routes[i].legs[0].steps[step].end_location);
								infoLeg.open(map);
								infoWindowArr.push(infoLeg);
							}
						} else {
							window.alert('Directions request failed due to ' + status);
						}
					});
				});

			}, function error(msg) {
				alert('Please enable your GPS.');

			}, {
				maximumAge: 600000,
				//timeout: 5000,
				enableHighAccuracy: true
			});
		}


	}

	function calculateAndDisplayRoute(map, directionsDisplay, directionsService, directionDisplay, pointA, pointB, golInfo) {
		directionsService.route({
			origin: pointA,
			destination: pointB,
			provideRouteAlternatives: true,
			travelMode: google.maps.TravelMode.DRIVING,
			optimizeWaypoints: true
		}, function(response, status) {
			if (status == google.maps.DirectionsStatus.OK) {
				for (i = 0; i < directionsDisplay.length; i++) {
					directionsDisplay[i].setMap(null);
				}

				for (i = 0; i < response.routes.length; i++) {
					directionDisplay = new google.maps.DirectionsRenderer({
						map: map,
						directions: response,
						routeIndex: i
					})
					directionsDisplay.push(directionDisplay);
					//var infoLeg = new google.maps.InfoWindow();
					var step = Math.floor(response.routes[i].legs[0].steps.length - 1);
					golInfo.setContent(response.routes[i].legs[0].distance.text + "<br>" + response.routes[i].legs[0].duration.text + " ");
					golInfo.setPosition(response.routes[i].legs[0].steps[step].end_location);
					golInfo.open(map);
				}
			} else {
				window.alert('Directions request failed due to ' + status);
			}
		});
	}
</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBMZKcVJJ0FCXeUyYYsVl5_Y22aIOgTAxQ&callback=initMap&libraries=geometry" type="text/javascript"></script>

</html>
